<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A methodological approach to assess the best weather spatialization technique • agrometeoR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A methodological approach to assess the best weather spatialization technique">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">agrometeoR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Development_roadmap.html">Development Roadmap</a>
    </li>
    <li>
      <a href="../articles/Partners.html">Partners</a>
    </li>
    <li>
      <a href="../articles/Presentation_agromet_project.html">Presentation of the Agromet Project</a>
    </li>
    <li>
      <a href="../articles/Spatialization_method_approach.html">A methodological approach to assess the best weather spatialization technique</a>
    </li>
    <li>
      <a href="../articles/benchmarking_example.html">Benchmarking example</a>
    </li>
    <li>
      <a href="../articles/gstat_integration_mlr.html">Integration of gstat into mlr</a>
    </li>
    <li>
      <a href="../articles/interpolation_grid_creation.html">Creation of the interpolation Grid</a>
    </li>
    <li>
      <a href="../articles/spatialization_example.html">A simple spatialization example using agrometeoR</a>
    </li>
    <li>
      <a href="../articles/understanding_knn.html">Verifying 5nn interpolation with gstat implemented in mlr</a>
    </li>
    <li>
      <a href="../articles/using_packrat.html">Using packrat</a>
    </li>
    <li>
      <a href="../articles/weather_spatialisation_review.html">Agromet : Weather Spatialization Review and Benchmark</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../tutorials/presentation.html">FOSS4GBXL2018</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pokyah/agrometeoR">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>A methodological approach to assess the best weather spatialization technique</h1>
                        <h4 class="author">02/04/2019</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pokyah/agrometeoR/blob/master/vignettes/Spatialization_method_approach.Rmd"><code>vignettes/Spatialization_method_approach.Rmd</code></a></small>
      <div class="hidden name"><code>Spatialization_method_approach.Rmd</code></div>

    </div>

    
    
<div id="context-objectives" class="section level1">
<h1 class="hasAnchor">
<a href="#context-objectives" class="anchor"></a>1. Context &amp; objectives</h1>
<div id="context" class="section level2">
<h2 class="hasAnchor">
<a href="#context" class="anchor"></a>1.1. Context</h2>
<p>European directive <a href="http://www.eppo.int/PPPRODUCTS/information/2009_0128_EU-e.pdf">2009/128/CE</a> : establishing a framework for Community action to achieve the sustainable use of pesticides</p>
<details><summary>more</summary><p>
<!-- the above p cannot start right at the beginning of the line and is mandatory for everything else to work -->
The European directive 2009/128/CE imposes member-states to set up tools that allow for a more rational use of crop protection products. Among these tools, agricultural warning systems, based on crop monitoring models for the control of pests and diseases are widely adopted and have proved their efficiency. However, due to the difficulty to get meteorological data at high spatial resolution (at the parcel scale), they still are underused. The use of geostatistical tools (Kriging, Multiple Regressions, Artificial Neural Networks, etc.) makes it possible to interpolate data provided by physical weather stations in such a way that a high spatial resolution network (mesh size of 1 km2) of virtual weather stations could be generated. That is the objective of the AGROMET project.
</p>
<p></p></details>
</div>
<div id="objective" class="section level2">
<h2 class="hasAnchor">
<a href="#objective" class="anchor"></a>1.2. Objective</h2>
<p>Provide hourly 1km² gridded datasets of weather parameters with the best accuracy (i.e. spatialize hourly records from the stations on the whole area of Wallonia) = <strong>SPATIALIZATION</strong></p>
<details><summary>more</summary><p>
<!-- the above p cannot start right at the beginning of the line and is mandatory for everything else to work -->
The project aims to set up an operational web-platform designed for real-time agro-meteorological data dissemination at high spatial (1km2) and temporal (hourly) resolution. To achieve the availability of data at such a high spatial resolution, we plan to “spatialize” the real-time data sent by more than 30 connected physical weather stations belonging to the PAMESEB and RMI networks. This spatialization will then result in a gridded dataset corresponding to a network of 16 000 virtual stations uniformly spread on the whole territory of Wallonia. These “spatialized” data will be made available through a web-platform providing interactive visualization widgets (maps, charts, tables and various indicators) and an API allowing their use on the fly, notably by agricultural warning systems providers. An extensive and precise documentation about data origin, geo-statistic algorithms used and uncertainty will also be available.
</p>
<p></p></details><p>Best suited tools :</p>
<ol style="list-style-type: decimal">
<li>
<del><strong>physical atmospherical models</strong></del> <small>(not straight forward to develop an explicit physical model describing how the output data can be derived from the input data) </small>
</li>
<li>
<strong>supervised machine learning <a href="https://math.stackexchange.com/questions/141381/regression-vs-classification">regression</a> algorithms</strong> that given a set of continuous data, find the best relationship that represents the set of continuous data <small>(common approach largely discussed in the academic litterature)</small>
</li>
</ol>
<ul>
<li><strong>Our main goal will be to choose, for each weather parameter, the best suited supervised machine learning regression method</strong></li>
</ul>
</div>
</div>
<div id="key-definitions" class="section level1">
<h1 class="hasAnchor">
<a href="#key-definitions" class="anchor"></a>2. Key definitions</h1>
<div id="spatialization" class="section level2">
<h2 class="hasAnchor">
<a href="#spatialization" class="anchor"></a>2.1. Spatialization</h2>
<p>Spatialization or spatial interpolation creates a <strong>continuous surface</strong> from values measured at discrete locations to <strong>predict</strong> values at any location in the interest zone with the <strong>best accuracy</strong>.</p>
<p>In the chapter <em>The principles of geostatistical analysis</em> of the <a href="http://dusk2.geo.orst.edu/gis/geostat_analyst.pdf">Using ArcGis Geostatistical analyst</a>, K. Johnston gives an efficient overview of what spatialization is and what are the two big groups of techniques (deterministic and <strong>stochastic</strong>).</p>
</div>
<div id="supervised-machine-learning" class="section level2">
<h2 class="hasAnchor">
<a href="#supervised-machine-learning" class="anchor"></a>2.2. Supervised machine learning</h2>
<p>From <a href="https://machinelearningmastery.com/supervised-and-unsupervised-machine-learning-algorithms/">machinelearningmastery.com</a> :</p>
<blockquote>
<p>Supervised learning is where you have input variables (x) and an output variable (Y) and you use an algorithm to learn the mapping function from the input to the output : <code>Y = f(X)</code><br> The goal is to approximate the mapping function so well that when you have new input data (x), you can predict the output variables (Y) for that data.<br> It is called supervised learning because the process of an algorithm learning from the training dataset can be thought of as a teacher supervising the learning process</p>
</blockquote>
<p>Also check this worth reading <a href="https://medium.com/@ageitgey/machine-learning-is-fun-80ea3ec3c471">post</a></p>
</div>
</div>
<div id="defining-the-best-supervised-machine-learning-regression-method" class="section level1">
<h1 class="hasAnchor">
<a href="#defining-the-best-supervised-machine-learning-regression-method" class="anchor"></a>3. Defining the best supervised machine learning regression method</h1>
<div id="our-general-approach" class="section level2">
<h2 class="hasAnchor">
<a href="#our-general-approach" class="anchor"></a>3.1. Our general approach</h2>
<ul>
<li><p>Inspired from work of <a href="https://github.com/pokyah/agrometeor-spatialization-review-benchmark/tree/master/assets/ZEPP">ZEPP</a> + <a href="https://github.com/pokyah/agrometeor-spatialization-review-benchmark/tree/master/assets/arvalis">Arvalis</a> + <a href="https://github.com/pokyah/agrometeor-spatialization-review-benchmark/tree/master/assets/IRCELINE">IRCeline</a></p></li>
<li><p>… to transpose into R-code</p></li>
<li><p>… using supervised machine learning techniques</p></li>
<li><p>… as proposed in the excellent <a href="https://geocompr.robinlovelace.net/">geocomputation with R</a> book from PhD <a href="http://www.robinlovelace.net/about/">Robin Lovelace</a>.</p></li>
</ul>
</div>
<div id="step-by-step-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#step-by-step-workflow" class="anchor"></a>3.2. Step-by-step workflow</h2>
<ol style="list-style-type: decimal">
<li>From our <strong>historical dataset</strong> of hourly weather records (<a href="https://app.pameseb.be">Pameseb db</a>)</li>
<li>filter a representative subset of records (e.g. <strong>5 years of continuous hourly records</strong>) + select the “good” stations</li>
<li>For <strong>each hourly set of records</strong> (30 stations - or more (<a href="https://pokyah.github.io/AWS-Humain-comparison/reporting/Humain-presentation-revealjs.html#/">by integrating IRM network</a>? )</li>
<li>run a <strong>benchmark experiment</strong> where <strong>different desired regression learning algorithms</strong> are applied to various regression tasks (i.e. datasets with different combinations of explanatory variables + the target weather parameter) with the aim to compare and rank the combinations of algorithm + used explanatory variables using a <a href="https://www.researchgate.net/publication/226334863_Resampling_Strategies_for_Model_Assessment_and_Selection">cross validation resampling strategy</a> (LOOCV) that provides the desired <a href="https://medium.com/human-in-a-machine-world/mae-and-rmse-which-metric-is-better-e60ac3bde13d">performance metrics</a> (<a href="https://www.geosci-model-dev.net/7/1247/2014/gmd-7-1247-2014.pdf">RMSE or MAE?</a>)</li>
</ol>
<hr>
<ol start="5" style="list-style-type: decimal">
<li>Then <strong>aggregate, by calculating the mean</strong>, all the hourly performance measures on the whole representative subset to choose the method (= regression learning algorithm + regression task) that globally performs the best</li>
<li>For each desired hourly dataset, apply the choosen method to <strong>build a model</strong> to make spatial predictions</li>
<li>
<strong>Use maps</strong> to <a href="http://spatial-analyst.net/wiki/index.php/Uncertainty_visualization#Visualization_of_uncertainty_using_whitening_in_R">vizualize the predictions and their uncertainty</a>
</li>
<li>Make the predictions available on the platform together with its uncertainty indicator</li>
</ol>
</div>
<div id="workflow-activity-diagrams" class="section level2">
<h2 class="hasAnchor">
<a href="#workflow-activity-diagrams" class="anchor"></a>3.3. workflow activity diagrams</h2>
<p><a href="./assets/uml_images/spatialization-methodology.svg">spatialization methodology viewer</a></p>
</div>
<div id="which-target-dependent-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#which-target-dependent-variables" class="anchor"></a>3.4. Which target dependent variables ?</h2>
<p>… or variables to be spatialized</p>
<ul>
<li>temperature (a lot of litterature with expertise from KNMI + RMI)</li>
<li>relative humidity (performed by Arvalis + ZEPP)</li>
<li>
<del>rainfall</del> (RMI rain radar)</li>
<li>leaves wetness (none of our partners)</li>
</ul>
</div>
<div id="which-independent-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#which-independent-variables" class="anchor"></a>3.5. Which independent variables ?</h2>
<p>… or explanatory variables</p>
<ul>
<li>digital elevation model and its derivatives like aspect and slope (available from R command line using <code>getData</code> from <a href="https://cran.r-project.org/web/packages/raster/index.html">Raster</a> package)</li>
<li>solar irradiance (available from <a href="https://landsaf.ipma.pt/en/products/longwave-shortwave-radiation/dssf/">eumetsat - lsa saf</a>)</li>
<li>other ? (distance to sea, CORINE land cover, temporal series, etc…)</li>
</ul>
</div>
<div id="which-r-config-and-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#which-r-config-and-packages" class="anchor"></a>3.6. Which R config and packages ?</h2>
<p>In order to ensure science reproductibility (<a href="https://www.sevenbridges.com/docker-based-solutions-to-reproducibility-in-science/">why it is important</a>), the code (<a href="https://medium.com/activewizards-machine-learning-company/top-20-r-libraries-for-data-science-in-2018-infographic-956f8419f883">R</a>) is developed in a self-maintained and publicly available <a href="https://github.com/pokyah/agrometeorDocker">Docker image</a></p>
<p>In addition to the famous <a href="https://www.tidyverse.org/">tidyverse</a> packages suite, we use bleeding edge R packages :</p>
<ul>
<li>from sp to the new <a href="https://edzer.github.io/UseR2017/">sf</a> (perfect integration with dplyr verbs and with the OGC <a href="https://en.wikipedia.org/wiki/Simple_Features">simple feature</a> standard) for spatial data handling</li>
<li>
<a href="https://mlr-org.github.io">mlr</a> : an umbrella-package providing a unified interface to dozens of learning algorithms</li>
</ul>
</div>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>4. Conclusion</h1>
<ul>
<li>Thanks to exchanges with our partners (Steering Committee and KNMI + ZEPP + Arvalis) and an extensive review (both in terms of spatial prediction theory and R-coding),</li>
<li>we have figured out how to setup &amp; code an R-facility to find the best suited interpolation method for each of our weather params</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#context-objectives">1. Context &amp; objectives</a><ul class="nav nav-pills nav-stacked">
<li><a href="#context">1.1. Context</a></li>
      <li><a href="#objective">1.2. Objective</a></li>
      </ul>
</li>
      <li>
<a href="#key-definitions">2. Key definitions</a><ul class="nav nav-pills nav-stacked">
<li><a href="#spatialization">2.1. Spatialization</a></li>
      <li><a href="#supervised-machine-learning">2.2. Supervised machine learning</a></li>
      </ul>
</li>
      <li>
<a href="#defining-the-best-supervised-machine-learning-regression-method">3. Defining the best supervised machine learning regression method</a><ul class="nav nav-pills nav-stacked">
<li><a href="#our-general-approach">3.1. Our general approach</a></li>
      <li><a href="#step-by-step-workflow">3.2. Step-by-step workflow</a></li>
      <li><a href="#workflow-activity-diagrams">3.3. workflow activity diagrams</a></li>
      <li><a href="#which-target-dependent-variables">3.4. Which target dependent variables ?</a></li>
      <li><a href="#which-independent-variables">3.5. Which independent variables ?</a></li>
      <li><a href="#which-r-config-and-packages">3.6. Which R config and packages ?</a></li>
      </ul>
</li>
      <li><a href="#conclusion">4. Conclusion</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thomas Goossens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
