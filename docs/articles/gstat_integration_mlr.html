<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Integration of gstat into mlr • agrometeoR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Integration of gstat into mlr">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">agrometeoR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/benchmarking_example.html">Benchmarking example</a>
    </li>
    <li>
      <a href="../articles/gstat_integration_mlr.html">Integration of gstat into mlr</a>
    </li>
    <li>
      <a href="../articles/interpolation_grid_creation.html">Creation of the interpolation Grid</a>
    </li>
    <li>
      <a href="../articles/networks_intercomparison.html">Networks Intercomparison</a>
    </li>
    <li>
      <a href="../articles/presentation-agromet-project.html">Presentation of the Agromet Project</a>
    </li>
    <li>
      <a href="../articles/spatialization_example.html">A simple spatialization example using agrometeoR</a>
    </li>
    <li>
      <a href="../articles/two_years_benchmark.html">a 2 years benchmark</a>
    </li>
    <li>
      <a href="../articles/using_packrat.html">Using packrat</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../tutorials/presentation.html">FOSS4GBXL2018</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pokyah/agrometeoR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Integration of gstat into mlr</h1>
                        <h4 class="author">Thomas Goossens</h4>
            
            <h4 class="date">11/23/2018</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pokyah/agrometeoR/blob/master/vignettes/gstat_integration_mlr.Rmd"><code>vignettes/gstat_integration_mlr.Rmd</code></a></small>
      <div class="hidden name"><code>gstat_integration_mlr.Rmd</code></div>

    </div>

    
    
<pre><code>## Warning: replacing previous import 'BBmisc::isFALSE' by
## 'backports::isFALSE' when loading 'ParamHelpers'</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"stations.static"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"stations.dyn"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"grid.static"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"grid.dyn"</span>)</code></pre></div>
<p>For the gstat use case we use the well-known <code>meuse</code> and <code>meuse.grid</code> datasets from <a href="https://cran.r-project.org/web/packages/sp/index.html">sp</a> package.</p>
<p>The purpose of this vignette is to demonstrate how to use gstat spatial prediction functionalities from the mlr interface.</p>
<p>Original gstat code will be presented with its mlr counterpart for various spatial prediction methods (Inverse Distance Weighted, trend surfaces, ordinaray kriging and kriging with external drift).</p>
<p>The examples presented in this vignette are inspired by the examples provided in the gstat <a href="https://cran.r-project.org/web/packages/gstat/vignettes/gstat.pdf">vignette</a></p>
<p>First, let’s prepare the required libraries</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(gstat)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sp)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(mlr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</code></pre></div>
<div id="inverse-distance-weighted" class="section level2">
<h2 class="hasAnchor">
<a href="#inverse-distance-weighted" class="anchor"></a>Inverse distance Weighted</h2>
<p>Here is the code using pure <strong>gstat</strong> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># making spatial</span>
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse.grid) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(meuse.grid) =<span class="st"> </span><span class="ot">TRUE</span>
<span class="co"># interpolating</span>
zinc.idw =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/krige">idw</a></span>(zinc<span class="op">~</span><span class="dv">1</span>, meuse, meuse.grid)
## [inverse distance weighted interpolation]
<span class="co"># mapping</span>
idw.gstat.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(zinc.idw[<span class="st">"var1.pred"</span>], <span class="dt">do.log =</span> F, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>,  <span class="dt">main =</span> <span class="st">"zn : idw interpoaltion (gstat)"</span>)</code></pre></div>
<p>And using <strong>mlr</strong> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># defining the regression task</span>
task =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/Task">makeRegrTask</a></span>(<span class="dt">id =</span> <span class="st">"meuse"</span>,  <span class="dt">data =</span> meuse, <span class="dt">target =</span> <span class="st">"zinc"</span>)
task.idw =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/dropFeatures">dropFeatures</a></span>(<span class="dt">task =</span> task, <span class="dt">features =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/getTaskFeatureNames">getTaskFeatureNames</a></span>(task)[<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>)])
<span class="co"># defining the learner</span>
lrn.idw =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/makeLearner">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"regr.gstat"</span>, <span class="dt">id =</span> <span class="st">"mlr-idw"</span>)
<span class="co"># training the model</span>
mod.idw =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/train">train</a></span>(lrn.idw, task.idw)
<span class="co"># interpolating</span>
newdata.pred.idw =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(mod.idw, <span class="dt">newdata =</span> meuse.grid)
## [inverse distance weighted interpolation]
mlr.idw =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(meuse.grid), newdata.pred.idw<span class="op">$</span>data)
<span class="co"># mapping</span>
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(mlr.idw) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(mlr.idw) =<span class="st"> </span><span class="ot">TRUE</span>
idw.mlr.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(mlr.idw[<span class="st">"response"</span>], <span class="dt">do.log =</span> F, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"zn : idw interpoaltion (mlr)"</span>)</code></pre></div>
<p>Let’s check that spatial predictions outputs are identical for the 2 methods :</p>
<p><img src="gstat_integration_mlr_files/figure-html/idw_maps-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/identical">identical</a></span>(zinc.idw[<span class="st">"var1.pred"</span>]<span class="op">@</span>data[[<span class="dv">1</span>]], mlr.idw[<span class="st">"response"</span>]<span class="op">@</span>data[[<span class="dv">1</span>]])
## [1] TRUE</code></pre></div>
</div>
<div id="trend-surfaces-interpolation-" class="section level2">
<h2 class="hasAnchor">
<a href="#trend-surfaces-interpolation-" class="anchor"></a>Trend surfaces interpolation.</h2>
<p>Here is the code using pure <strong>gstat</strong> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse.grid)
<span class="co"># imputing values to missing data (using mlr::imput)</span>
meuse =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># making spatial</span>
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse.grid) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(meuse.grid) =<span class="st"> </span><span class="ot">TRUE</span>
<span class="co"># interpolating</span>
ts.gstat =<span class="st"> </span>meuse.grid
ts.gstat<span class="op">$</span>ts1 =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/krige">krige</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(zinc) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, meuse, meuse.grid, <span class="dt">degree =</span> <span class="dv">1</span>)<span class="op">$</span>var1.pred
## [ordinary or weighted least squares prediction]
ts.gstat<span class="op">$</span>ts2 =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/krige">krige</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(zinc) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, meuse, meuse.grid, <span class="dt">degree =</span> <span class="dv">2</span>)<span class="op">$</span>var1.pred
## [ordinary or weighted least squares prediction]
ts.gstat<span class="op">$</span>ts3 =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/krige">krige</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(zinc) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, meuse, meuse.grid, <span class="dt">degree =</span> <span class="dv">3</span>)<span class="op">$</span>var1.pred
## [ordinary or weighted least squares prediction]
<span class="co"># mapping</span>
ts.gstat.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ts.gstat, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"ts1"</span>, <span class="st">"ts2"</span>, <span class="st">"ts3"</span>), <span class="dt">main =</span> <span class="st">"log(zn) : ts interpolation (gstat)"</span>)</code></pre></div>
<p>And using <strong>mlr</strong> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># adding a column with log zinc</span>
meuse =<span class="st"> </span>meuse <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">log_zinc =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(zinc))
<span class="co"># defining the regression task</span>
task =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/Task">makeRegrTask</a></span>(<span class="dt">id =</span> <span class="st">"meuse"</span>,  <span class="dt">data =</span> meuse, <span class="dt">target =</span> <span class="st">"log_zinc"</span>)
task.ts =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/dropFeatures">dropFeatures</a></span>(<span class="dt">task =</span> task, <span class="dt">features =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/getTaskFeatureNames">getTaskFeatureNames</a></span>(task)[<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>)])
<span class="co"># defining the learner</span>
lrn.ts.<span class="dv">1</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/makeLearner">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"regr.gstat"</span>, <span class="dt">id =</span> <span class="st">"mlr-ts1"</span>, <span class="dt">degree =</span> <span class="dv">1</span>)
lrn.ts.<span class="dv">2</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/makeLearner">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"regr.gstat"</span>, <span class="dt">id =</span> <span class="st">"mlr-ts2"</span>, <span class="dt">degree =</span> <span class="dv">2</span>)
lrn.ts.<span class="dv">3</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/makeLearner">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"regr.gstat"</span>, <span class="dt">id =</span> <span class="st">"mlr-ts3"</span>, <span class="dt">degree =</span> <span class="dv">3</span>)
<span class="co"># training the learners</span>
mod.ts.<span class="dv">1</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/train">train</a></span>(lrn.ts.<span class="dv">1</span>, task.ts)
mod.ts.<span class="dv">2</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/train">train</a></span>(lrn.ts.<span class="dv">2</span>, task.ts)
mod.ts.<span class="dv">3</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/train">train</a></span>(lrn.ts.<span class="dv">3</span>, task.ts)
<span class="co"># interpolating</span>
ts.mlr =<span class="st"> </span>meuse.grid
newdata.pred.ts.<span class="dv">1</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(mod.ts.<span class="dv">1</span>, <span class="dt">newdata =</span> meuse.grid)
## [ordinary or weighted least squares prediction]
ts.mlr<span class="op">$</span>mlr.ts.<span class="dv">1</span> =<span class="st"> </span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(meuse.grid), newdata.pred.ts.<span class="dv">1</span><span class="op">$</span>data))<span class="op">$</span>response
newdata.pred.ts.<span class="dv">2</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(mod.ts.<span class="dv">2</span>, <span class="dt">newdata =</span> meuse.grid)
## [ordinary or weighted least squares prediction]
ts.mlr<span class="op">$</span>mlr.ts.<span class="dv">2</span> =<span class="st"> </span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(meuse.grid), newdata.pred.ts.<span class="dv">2</span><span class="op">$</span>data))<span class="op">$</span>response
newdata.pred.ts.<span class="dv">3</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(mod.ts.<span class="dv">3</span>, <span class="dt">newdata =</span> meuse.grid)
## [ordinary or weighted least squares prediction]
ts.mlr<span class="op">$</span>mlr.ts.<span class="dv">3</span> =<span class="st"> </span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(meuse.grid), newdata.pred.ts.<span class="dv">3</span><span class="op">$</span>data))<span class="op">$</span>response
<span class="co"># mapping</span>
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(ts.mlr) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(ts.mlr) =<span class="st"> </span><span class="ot">TRUE</span>
ts.mlr.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ts.mlr, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"mlr.ts.1"</span>, <span class="st">"mlr.ts.2"</span>, <span class="st">"mlr.ts.3"</span>), <span class="dt">main =</span> <span class="st">"log(zn) : ts interpolation (mlr)"</span>)</code></pre></div>
<p>Let’s check that spatial predictions outputs are identical for the 2 methods :</p>
<p><img src="gstat_integration_mlr_files/figure-html/ts_maps-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/identical">identical</a></span>(ts.mlr<span class="op">$</span>mlr.ts.<span class="dv">1</span>, ts.gstat<span class="op">$</span>ts1)
## [1] TRUE
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/identical">identical</a></span>(ts.mlr<span class="op">$</span>mlr.ts.<span class="dv">2</span>, ts.gstat<span class="op">$</span>ts2)
## [1] TRUE
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/identical">identical</a></span>(ts.mlr<span class="op">$</span>mlr.ts.<span class="dv">3</span>, ts.gstat<span class="op">$</span>ts3)
## [1] TRUE</code></pre></div>
</div>
<div id="ordinary-kriging-example" class="section level2">
<h2 class="hasAnchor">
<a href="#ordinary-kriging-example" class="anchor"></a>Ordinary kriging example</h2>
<p>Here is the code using pure <strong>gstat</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># making spatial</span>
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse.grid) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(meuse.grid) =<span class="st"> </span><span class="ot">TRUE</span>
<span class="co"># computing sample variogram</span>
lzn.vgm =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/variogram">variogram</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(zinc)<span class="op">~</span><span class="dv">1</span>, meuse)
<span class="co"># manually fitting a model to the vgm with constant mean</span>
lzn.fit =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/fit.variogram">fit.variogram</a></span>(lzn.vgm, <span class="dt">model =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/vgm">vgm</a></span>(<span class="dv">1</span>, <span class="st">"Sph"</span>, <span class="dv">900</span>, <span class="dv">1</span>))
<span class="co"># to show the plot run : plot(lzn.vgm, lzn.fit)</span>
<span class="co"># kriging</span>
ok.gstat =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/krige">krige</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(zinc)<span class="op">~</span><span class="dv">1</span>, meuse, meuse.grid, <span class="dt">model =</span> lzn.fit)
## [using ordinary kriging]
<span class="co"># mapping</span>
ok.gstat.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ok.gstat[<span class="st">"var1.pred"</span>], <span class="dt">do.log =</span> F, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"log(zn) : ok interpolation (gstat)"</span>)
<span class="co"># mapping the se</span>
ok.se.gstat.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ok.gstat[<span class="st">"var1.var"</span>], <span class="dt">do.log =</span> F, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"se(log(zn)) : ok interpolation (gstat)"</span>)</code></pre></div>
<p>And using <strong>mlr</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># adding a column with log zinc</span>
meuse =<span class="st"> </span>meuse <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">log_zinc =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(zinc))
<span class="co"># defining the regression task</span>
task =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/Task">makeRegrTask</a></span>(<span class="dt">id =</span> <span class="st">"meuse"</span>,  <span class="dt">data =</span> meuse, <span class="dt">target =</span> <span class="st">"log_zinc"</span>)
task.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/dropFeatures">dropFeatures</a></span>(<span class="dt">task =</span> task, <span class="dt">features =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/getTaskFeatureNames">getTaskFeatureNames</a></span>(task)[<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>)])
<span class="co"># defining the learner</span>
lrn.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/makeLearner">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"regr.gstat"</span>, <span class="dt">id =</span> <span class="st">"ln(zn) mlr ordinary kriging"</span>, <span class="dt">predict.type =</span> <span class="st">"response"</span>, <span class="dt">psill =</span> <span class="dv">1</span>, <span class="dt">model.manual =</span> <span class="st">"Sph"</span>, <span class="dt">range =</span> <span class="dv">900</span>, <span class="dt">nugget =</span> <span class="dv">1</span>)
<span class="co"># training the model</span>
mod.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/train">train</a></span>(lrn.krg, task.krg)
<span class="co"># kriging</span>
newdata.pred.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(<span class="dt">object =</span> mod.krg, <span class="dt">newdata =</span> meuse.grid)
## [using ordinary kriging]
ok.mlr =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(meuse.grid), newdata.pred.krg<span class="op">$</span>data)
<span class="co"># mapping</span>
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(ok.mlr) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(ok.mlr) =<span class="st"> </span><span class="ot">TRUE</span>
ok.mlr.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ok.mlr[<span class="st">"response"</span>], <span class="dt">do.log =</span> T, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"log(zn) : ok interpolation (gstat)"</span>)
<span class="co"># SE - defining the standard error learner by altering the previous one.</span>
se.lrn.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/setPredictType">setPredictType</a></span>(lrn.krg, <span class="dt">predict.type =</span> <span class="st">"se"</span>)
<span class="co"># training the SE model</span>
se.mod.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/train">train</a></span>(se.lrn.krg, task.krg)
<span class="co"># SE kriging</span>
se.newdata.pred.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(<span class="dt">object =</span> se.mod.krg, <span class="dt">newdata =</span> meuse.grid)
## [using ordinary kriging]
ok.se.mlr =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(meuse.grid), se.newdata.pred.krg<span class="op">$</span>data)
<span class="co"># SE mapping</span>
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(ok.se.mlr) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(ok.se.mlr) =<span class="st"> </span><span class="ot">TRUE</span>
ok.se.mlr.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ok.se.mlr[<span class="st">"se"</span>], <span class="dt">do.log =</span> T, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"se(log(zn)) : ok interpolation (mlr)"</span>)</code></pre></div>
<p>Let’s check that spatial predictions outputs are identical for the 2 methods :</p>
<p><img src="gstat_integration_mlr_files/figure-html/ok_maps-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/identical">identical</a></span>(ok.gstat[<span class="st">"var1.pred"</span>]<span class="op">@</span>data[[<span class="dv">1</span>]], ok.mlr[<span class="st">"response"</span>]<span class="op">@</span>data[[<span class="dv">1</span>]])
## [1] TRUE</code></pre></div>
</div>
<div id="kriging-with-external-drift-ked-universal-kriging-uk" class="section level2">
<h2 class="hasAnchor">
<a href="#kriging-with-external-drift-ked-universal-kriging-uk" class="anchor"></a>Kriging with External Drift (KED) = Universal Kriging (UK)</h2>
<p>Using <strong>gstat</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># making spatial</span>
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(meuse.grid) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(meuse.grid) =<span class="st"> </span><span class="ot">TRUE</span>
<span class="co"># computing sample variogram</span>
lzn.vgm =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/variogram">variogram</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(zinc)<span class="op">~</span><span class="dv">1</span>, meuse)
<span class="co"># manually fitting a model to the vgm with a mean function where sqrt dist is the explanatory var</span>
lzn.vgm =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/variogram">variogram</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(zinc)<span class="op">~</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(dist), meuse)
lzn.fit =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/fit.variogram">fit.variogram</a></span>(lzn.vgm, <span class="dt">model =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/vgm">vgm</a></span>(<span class="dv">1</span>, <span class="st">"Exp"</span>, <span class="dv">300</span>, <span class="dv">1</span>))
<span class="co"># to show the plot run : plot(lzn.vgm, lzn.fit)</span>
<span class="co"># kriging</span>
ked.gstat =<span class="st"> </span>gstat<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/krige">krige</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(zinc)<span class="op">~</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(dist), meuse, meuse.grid, <span class="dt">model =</span> lzn.fit)
## [using universal kriging]
<span class="co"># mapping</span>
ked.gstat.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ked.gstat[<span class="st">"var1.pred"</span>], <span class="dt">do.log =</span> F, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"log(zn) : ked interpolation (gstat)"</span>)
<span class="co"># mapping the se</span>
ked.se.gstat.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ked.gstat[<span class="st">"var1.var"</span>], <span class="dt">do.log =</span> F, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"se(log(zn)) : ked interpolation (gstat)"</span>)</code></pre></div>
<p>And using <strong>mlr</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loading datasets</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(meuse.grid)
<span class="co"># imputing values to missing data</span>
meuse =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
meuse.grid =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/impute">impute</a></span>(meuse.grid, <span class="dt">classes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">numeric =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMean</a></span>(), <span class="dt">factor =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/imputations">imputeMode</a></span>()),
  <span class="dt">dummy.classes =</span> <span class="st">"integer"</span>)<span class="op">$</span>data
<span class="co"># adding a column with log zinc</span>
meuse =<span class="st"> </span>meuse <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">log_zinc =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(zinc))
<span class="co"># adding a column with sqrt dist</span>
meuse =<span class="st"> </span>meuse <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">sqrt_dist =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(dist))
meuse.grid =<span class="st"> </span>meuse.grid <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">sqrt_dist =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(dist))
<span class="co"># defining the regression task</span>
task =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/Task">makeRegrTask</a></span>(<span class="dt">id =</span> <span class="st">"meuse"</span>,  <span class="dt">data =</span> meuse, <span class="dt">target =</span> <span class="st">"log_zinc"</span>)
task.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/dropFeatures">dropFeatures</a></span>(<span class="dt">task =</span> task, <span class="dt">features =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/getTaskFeatureNames">getTaskFeatureNames</a></span>(task)[<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">15</span>)])
<span class="co"># defining the learner</span>
lrn.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/makeLearner">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"regr.gstat"</span>, <span class="dt">id =</span> <span class="st">"ln(zn) mlr kriging with external drift"</span>, <span class="dt">predict.type =</span> <span class="st">"response"</span>,  <span class="dt">psill =</span> <span class="dv">1</span>, <span class="dt">model.manual =</span> <span class="st">"Exp"</span>, <span class="dt">range =</span> <span class="dv">300</span>, <span class="dt">nugget =</span> <span class="dv">1</span>)
<span class="co"># training the model</span>
mod.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/train">train</a></span>(lrn.krg, task.krg)
<span class="co"># kriging</span>
newdata.pred.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(<span class="dt">object =</span> mod.krg, <span class="dt">newdata =</span> meuse.grid)
## [using universal kriging]
ked.mlr =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(meuse.grid), newdata.pred.krg<span class="op">$</span>data)
<span class="co"># mapping</span>
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(ked.mlr) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(ked.mlr) =<span class="st"> </span><span class="ot">TRUE</span>
ked.mlr.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ked.mlr[<span class="st">"response"</span>], <span class="dt">do.log =</span> T, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"log(zn) : ked interpolation (mlr)"</span>)
<span class="co"># SE - defining the standard error learner by altering the previous one.</span>
se.lrn.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/setPredictType">setPredictType</a></span>(lrn.krg, <span class="dt">predict.type =</span> <span class="st">"se"</span>)
<span class="co"># training the SE model</span>
se.mod.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mlr/topics/train">train</a></span>(se.lrn.krg, task.krg)
<span class="co"># SE kriging</span>
se.newdata.pred.krg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gstat/topics/predict.gstat">predict</a></span>(<span class="dt">object =</span> se.mod.krg, <span class="dt">newdata =</span> meuse.grid)
## [using universal kriging]
ked.se.mlr =<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(meuse.grid), se.newdata.pred.krg<span class="op">$</span>data)
<span class="co"># SE mapping</span>
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(ked.se.mlr) =<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y
sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(ked.se.mlr) =<span class="st"> </span><span class="ot">TRUE</span>
ked.se.mlr.plot =<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/spplot">spplot</a></span>(ked.se.mlr[<span class="st">"se"</span>], <span class="dt">do.log =</span> T, <span class="dt">colorkey =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">"se(log(zn)) : ked interpolation (mlr)"</span>)</code></pre></div>
<p>Let’s check that spatial predictions outputs are identical for the 2 methods :</p>
<p><img src="gstat_integration_mlr_files/figure-html/ked_maps-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/identical">identical</a></span>(ked.gstat[<span class="st">"var1.pred"</span>]<span class="op">@</span>data[[<span class="dv">1</span>]], ked.mlr[<span class="st">"response"</span>]<span class="op">@</span>data[[<span class="dv">1</span>]])
## [1] TRUE</code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#inverse-distance-weighted">Inverse distance Weighted</a></li>
      <li><a href="#trend-surfaces-interpolation-">Trend surfaces interpolation.</a></li>
      <li><a href="#ordinary-kriging-example">Ordinary kriging example</a></li>
      <li><a href="#kriging-with-external-drift-ked-universal-kriging-uk">Kriging with External Drift (KED) = Universal Kriging (UK)</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thomas Goossens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
